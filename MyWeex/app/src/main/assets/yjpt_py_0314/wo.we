<template>
   <wxc-navpage data-role="none" height={{navBarHeight}} background-color="#00cc99" title="我"
    title-color="white" onclickleftitem="onclickleftitem" left-item-src="{{headLeft}}" >
      <scroller class="content">
          <div class="mycake h_160"  onclick="QRScan">
              <text class="nameType" >头像</text>
              <image class="pic_thumb" style="left: 180; " src="{{myPortraitUrl}}" ></image>
              <image class="rightli"src="{{arrRight}}" style=" width: 22; height: 35;" ></image>
          </div>
          <!--<arrow-item repeat="{{basicDataList}}"></arrow-item>-->
          <!-- <arrow-item repeat="{{basicDataList}}"></arrow-item> -->
         
           <div class="mycake" onclick="openNamePage">
               <div><text class="nameType">姓名</text></div>
               <text class="rightli rightName">{{name}}</text>
              <text class="rightli">></text>
          </div>
          <div class="mycake" onclick="openSexPage">
               <div><text class="nameType">性别</text></div>
               <text class="rightli rightName">{{gender}}</text>
              <text class="rightli">></text>
          </div>
          <div class="mycake" onclick="addOpenPage">
               <div><text class="nameType">地区</text></div>
               <text class="rightli rightName ">{{address}}</text>
              <text class="rightli">></text>
          </div>
      </scroller>
  </wxc-navpage>
</template>
<style>
    .content {
      color: #353535;
      background-color: #efeff4;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }
    .mycake{flex-direction:row; width:750; height: 110; background-color: #ffffff; 
      border-bottom-width: 1;
      border-bottom-color: #e5e5e5;
      display: flex;
      align-items: center; 
      justify-content: space-between; padding-left:15; padding-right:30; 
       }
    .h_160{ height: 160;} 
    .rightName { flex: 2; padding-right: 20; text-align:right; font-size: 34; color: #444; font-family:微软雅黑;  text-overflow: ellipsis; lines:1;}
    .nameType{ font-size: 36; text-align: left; padding-left: 30;padding-right: 30;}
    .rightli{font-size: 45; color:#cccccc;}
    .pic_thumb { width: 130; height: 130; border-radius: 65; }
    .scanCode{border-top-color: #efeff4; border-top-width:10;}
    .scanCodeName{ background-color: #FF9966; padding-top: 20; padding-bottom: 20; border-radius: 10; margin: 38; margin-top: 25;  font-size: 40; color: #ffffff; text-align: center; }

</style>
<script>
  require('weex-components');
  var Utils = require('./javascript/Utils');
  var modal = require('@weex-module/modal');
  var storage = require('@weex-module/storage');
  var SJevent = require('@weex-module/SJevent');
  var geolocation = require('@weex-module/geolocation'); 

  module.exports = {
    data: {
      navBarHeight: 130,
      basicDataList:[
          {titleName:'姓名',src: 'yjpt/images/arrows_right.png',lName:'请选择（必填） ',url:'name'},
          {titleName:'性别',src: 'yjpt/images/arrows_right.png',lName:'男',url:'gender-setting'},
          {titleName:'地区',src: 'yjpt/images/arrows_right.png',lName:'深圳市  南山区 ',url:'wd_wo_dz'}
      ],
      myPortraitUrl:'',//头像
      userId:'',
      address:'未知',
      name : '未知',
      gender : '未知',
      
    },
    created : function(){
      var self = this;
      this.headLeft = Utils.ip + 'yjpt/images/id_right_bg.png';
      this.arrRight = Utils.ip +'yjpt/images/arrows_right.png';
      this.myPortraitUrl = Utils.ip + 'yjpt/images/photo_06.jpeg';
      this.$on('naviBar.leftItem.click',function(e){ 
          // history.back();
          Utils.navigate.pop(self,'true');
      }); 
      Utils.changeImg(this.basicDataList,['src']);
      var self = this;
      for (var i in this.basicDataList) {
        self.basicDataList[i].url = Utils.setOpenUrl(self.$getConfig(),self.basicDataList[i].url);
      } 


      storage.getItem('userId',function(e){
          self.userId = e.data;
          Utils.fetch({
              url:'/app/user?userId='+e.data,
              method:'get',
              dataType:'json',
              success:function(ret){
                  var user = ret.data.data;
                  console.log(user);
                  //头像
                  if(user.avatar){
                      self.myPortraitUrl =Utils.ip+'yjpt'+ user.avatar;
                  }
                  //姓名
                  if(user.realname){
                      self.name = user.realname;
                  }
                  //性别
                  if(user.gender == '1'){
                      self.gender = '男';
                  }else if(user.gender == '2'){
                      self.gender = '女';
                  }
                  // self.gender = user.gender;
                  //地区
                  if(user.region){
                      self.address = user.region;
                  }

                  // storage.setItem('userInfo',JSON.stringify(user));                 
              }
          });
      });
          
    },
    methods: {
       openNamePage : function(){
          var url=Utils.setOpenUrl(this.$getConfig(),'name');
          Utils.navigate.push(this,url,'true');
       },
       openSexPage : function(){
           var url=Utils.setOpenUrl(this.$getConfig(),'gender-setting');
           Utils.navigate.push(this,url,'true');
       },
       addOpenPage :function(){
            var self = this;
            // if(geolocation.getCurrentPosition){
            //     geolocation.getCurrentPosition({
            //         'accuracy': '1000',
            //         'distanceFilter': '10'
            //     },function(res){
            //           self.address = res.address.administrativeArea+res.address.locality+res.address.thoroughfare;

            //           Utils.fetch({
            //               url:'/app/user',
            //               data:'userId='+self.userId+'&addr='+ res.address.administrativeArea+'*'+res.address.locality+'*'+res.address.thoroughfare,
            //               type:'json',
            //               method:'POST',
            //               success:function(ret){
            //                 var _data=ret.data;
            //                 var obj = eval("(" + _data + ")");
            //                 if(obj.StatusCode == '200'){
            //                   modal.toast({
            //                     message:'修改成功',
            //                     duration:'1',
            //                   },function(){});

            //                   setTimeout(function(){
            //                       var url = Utils.setOpenUrl(self.$getConfig(),'index');
            //                       Utils.navigate.push(self,url,'true');   
            //                   },1000);
            //                 }else{
            //                       modal.toast({
            //                         message:'修改失败，请检查地址格式',
            //                         duration:'1'
            //                       },function(){});
            //                 }
            //               }
            //           });
            //     },function(){});
            // }
                
           // var url=Utils.setOpenUrl(this.$getConfig(),'wd_wo_dz');
           var url=Utils.setOpenUrl(this.$getConfig(),'city-picker');
           Utils.navigate.push(this,url,'true');
       },
       QRScan :function(){
          var self = this;
          storage.getItem('jsessionid',function(e){
              if(e.data != 'undefined'){
                  if(SJevent.PostSigalImg){       
                      var paramJson = {
                          userId : self.userId,
                          url:Utils.ip + Utils.dir+'course/file',
                          jsessionid:e.data
                      };
                      paramJson = JSON.stringify(paramJson);  

                      SJevent.PostSigalImg(paramJson,function(res){
                          if(res==0){
                              modal.toast({
                                  message:'上传失败，请稍后重试！',
                                  duration:'1'
                              },function(){});
                          }else{
                              var path = res.path;
                              modal.alert({
                                  message:res.path
                              },function(){});
                              // self.images.userImg = Utils.ip + 'yjpt' + path; 
                              self.myPortraitUrl = path; 
                          }
                      });
                  }else {
                      modal.alert({
                          message:'请在App中操作',
                          okTitle:'好的'
                      },function(){
                          
                      });
                  } 
              }
          });

        }
       
    }

  };
</script>
