<template>
    <wxc-navpage data-role="none" height={{navBarHeight}} background-color="#00cc99" title="选择班级" title-color="white" onclickleftitem="onclickleftitem" left-item-src="{{images.leftItemImg}}">
        <!--班级列表-->
        <div>
            <div class="class_list"  repeat='myClass' onclick="gotoMembers(id)">
                <text class="school_name">{{name}}</text> 
                <img class="arrow_bg" src="{{images.arrowRight}}" />               
            </div>
        </div>
</wxc-navpage>  
</template>
<style>
    .class_list{display: flex;flex-direction: row;border-bottom-width: 1px;border-bottom-color: #e7e7e7;border-bottom-style: solid;justify-content: space-between;align-items: center;padding: 45px;}
    .arrow_bg{height: 35px;width: 22px;}
</style>
<script>
    require('weex-components');
    var Utils = require('./javascript/Utils');
    var storage = require('@weex-module/storage');
    var modal = require('@weex-module/modal');
    module.exports = {
        data: {
            loading:false,   
            navBarHeight: 130,        
            classInfo:{
                name:'班级',
                classSelected:[]
            },
            userPhone:'',
            userClassList:[],
            myClass:[],
            images:{
                leftItemImg:'yjpt/images/id_right_bg.png',
                rightItemImg:'yjpt/images/menu.png',
                qrImg:'yjpt/images/ewm_icon.png',
                printIcon:'yjpt/images/print.png',
                arrowRight:'yjpt/images/arrows_right.png',
                blankRadio:'yjpt/images/checkbox_blank.png',
                selectRadio:'yjpt/images/checkbox_checked.png'
            },
            myClass:[],
            classMembers:[],
            classMemberUrl:'class-members'
        },
        created:function(){

            Utils.changeImg(this.images,['leftItemImg','qrImg','blankRadio','selectRadio']);
            Utils.changeImg(this.images,['arrowRight']);
            // Utils.changeImg(this.images2,['blankRadio','selectRadio']);
            this.$on('naviBar.leftItem.click',function(e){ 
                Utils.navigate.pop(this,'true');
            });

            var bundleUrl = this.$getConfig().bundleUrl;
            var nativeBase;
            var isAndroidAssets = bundleUrl.indexOf('file://assets/') >= 0;
            var isiOSAssets = bundleUrl.indexOf('file:///') >= 0 ;
            if (isAndroidAssets) {
              nativeBase = 'file://assets/yjpt/weex/';
            }
            else if (isiOSAssets) {
                nativeBase = bundleUrl.substring(0, bundleUrl.lastIndexOf('/') + 1);
            }
            else {
                var host = 'localhost:12580';
                var matches = /\/\/([^\/]+?)\//.exec(this.$getConfig().bundleUrl);
                if (matches && matches.length >= 2) {
                    host = matches[1];
                }
                nativeBase = 'http://' + host + '/' + this.dir + '/weex_jzd/';
            }
            var h5Base = './index.html?page=./' + this.dir + '/weex_jzd/';
            // in Native
            var base = nativeBase;
            if (typeof window === 'object') {
                // in Browser or WebView
                base = h5Base;
            }
            
            this.url = base + this.url + '.js';            

            var self = this;            
            // self.classCopy = self.class.join(',');                                
           
            storage.getItem('myClass',function(e){
                if(e.data){
                    self.myClass = JSON.parse(e.data);
                }
            });

            self.classMemberUrl = Utils.setOpenUrl(self.$getConfig(),self.classMemberUrl);
            
        },
        methods:{
            gotoMembers(classId){
                var self = this;
                Utils.fetch({
                    url:'/app/class/'+classId+'/detail',
                    method:'get',
                    dataType:'JSON',
                    success:function(res){
                        var result = eval('('+res.data+')');
                        if(result.StatusCode == '200'){
                            self.classMembers = result.data.teacherList.concat(result.data.studentList);
                            for(var i in self.classMembers){
                                self.classMembers[i].imgUrl = self.images.blankRadio;
                            }
                            
                            console.log(self.classMembers);

                            storage.setItem('classId',classId,function(){});
                            storage.setItem('classMembers',JSON.stringify(self.classMembers),function(){});
                            Utils.navigate.push(self,self.classMemberUrl,'true');

                        }else{
                            modal.toast({
                                message:'获取班级成员列表失败',
                                duration:'1'
                            });
                        }
                    }
                });
            }
            
        },
    }
</script>
